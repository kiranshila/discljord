<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>discljord.connections documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name"></span> <span class="project-version"></span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>discljord</span></div></div></li><li class="depth-2 branch"><a href="discljord.cdn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cdn</span></div></a></li><li class="depth-2 current"><a href="discljord.connections.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>connections</span></div></a></li><li class="depth-3 branch"><a href="discljord.connections.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-3"><a href="discljord.connections.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2"><a href="discljord.events.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>events</span></div></a></li><li class="depth-3 branch"><a href="discljord.events.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3"><a href="discljord.events.state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-2 branch"><a href="discljord.formatting.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>formatting</span></div></a></li><li class="depth-2 branch"><a href="discljord.http.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>http</span></div></a></li><li class="depth-2"><a href="discljord.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="discljord.messaging.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-3"><a href="discljord.messaging.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2 branch"><a href="discljord.permissions.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>permissions</span></div></a></li><li class="depth-2 branch"><a href="discljord.snowflakes.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>snowflakes</span></div></a></li><li class="depth-2 branch"><a href="discljord.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2"><a href="discljord.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="discljord.connections.html#var-add-shards.21"><div class="inner"><span>add-shards!</span></div></a></li><li class="depth-1"><a href="discljord.connections.html#var-connect-bot.21"><div class="inner"><span>connect-bot!</span></div></a></li><li class="depth-1"><a href="discljord.connections.html#var-connect-shards.21"><div class="inner"><span>connect-shards!</span></div></a></li><li class="depth-1"><a href="discljord.connections.html#var-create-activity"><div class="inner"><span>create-activity</span></div></a></li><li class="depth-1"><a href="discljord.connections.html#var-disconnect-bot.21"><div class="inner"><span>disconnect-bot!</span></div></a></li><li class="depth-1"><a href="discljord.connections.html#var-gateway-intents"><div class="inner"><span>gateway-intents</span></div></a></li><li class="depth-1"><a href="discljord.connections.html#var-get-shard-state.21"><div class="inner"><span>get-shard-state!</span></div></a></li><li class="depth-1"><a href="discljord.connections.html#var-get-websocket-gateway"><div class="inner"><span>get-websocket-gateway</span></div></a></li><li class="depth-1"><a href="discljord.connections.html#var-guild-request-members.21"><div class="inner"><span>guild-request-members!</span></div></a></li><li class="depth-1"><a href="discljord.connections.html#var-remove-shards.21"><div class="inner"><span>remove-shards!</span></div></a></li><li class="depth-1"><a href="discljord.connections.html#var-status-update.21"><div class="inner"><span>status-update!</span></div></a></li><li class="depth-1"><a href="discljord.connections.html#var-voice-state-update.21"><div class="inner"><span>voice-state-update!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">discljord.connections</h1><div class="doc"><pre class="plaintext">Namespace for creating a connection to Discord, and receiving messages.
Contains functionality required to create and maintain a sharded and auto-reconnecting
connection object which will receive messages from Discord, and pass them on to client
code.</pre></div><div class="public anchor" id="var-add-shards.21"><h3>add-shards!</h3><div class="usage"><code>(add-shards! connection-ch new-shards intents &amp; {:keys [disable-compression]})</code></div><div class="doc"><pre class="plaintext">Adds new shard connections using state fetched with `get-shard-state!`.
</pre></div></div><div class="public anchor" id="var-connect-bot.21"><h3>connect-bot!</h3><div class="usage"><code>(connect-bot! token out-ch &amp; {:keys [intents disable-compression]})</code></div><div class="doc"><pre class="plaintext">Creates a connection process which will handle the services granted by
Discord which interact over websocket.

Takes a token for the bot, and a channel on which all events from Discord
will be sent back across.

Returns a channel used to communicate with the process and send packets to
Discord.

Keep in mind that Discord sets a limit to how many shards can connect in a
given period. This means that communication to Discord may be bounded based on
which shard you use to talk to the server immediately after starting the bot.

`intents` is a set containing keywords representing which events will be sent
to the bot by Discord. Valid values for the set are in [[gateway-intents]].</pre></div></div><div class="public anchor" id="var-connect-shards.21"><h3>connect-shards!</h3><div class="usage"><code>(connect-shards! token out-ch gateway shard-ids &amp; {:keys [intents identify-when disable-compression]})</code></div><div class="doc"><pre class="plaintext">Connects a specific set of shard ids to Discord.

Acts like [[connect-bot!]], but also requires a gateway returned
from [[get-websocket-gateway]] and a sequence of shard-ids to connect with, as
well as a function used to determine when identify payloads are permitted to
be sent.

`identify` must be a function from token to core.async channel which yields an
item when an identify is permitted. This must be at least five seconds after
the most recent identify by any shard, however any additional attempts to
identify from this connection will include that wait by default, only
identifies from other connections must be taken into account for this.

The recommended number of shards for your bot can be determined by the return
value of [[get-websocket-gateway]].

If Discord determines the bot must re-shard, then a `:re-shard` event will be
emitted from the returned channel and all shards will be disconnected.

Because Discord has a limit of one shard connecting per five seconds, some
amount of synchronization between calls to [[connect-shards!]] must be had.
Additional calls should only be made five seconds after the
`:connected-all-shards` event has been received.</pre></div></div><div class="public anchor" id="var-create-activity"><h3>create-activity</h3><div class="usage"><code>(create-activity &amp; {:keys [name type url], :or {type :game}, :as args})</code></div><div class="doc"><pre class="plaintext">Takes keyword arguments and constructs an activity to be used in status updates.

Keyword Arguments:
name: a string which will display as the bot's status message, required
type: keywords :game, :stream, :music, or :watch which change how the status message displays, as "Playing", "Streaming", "Listening to", or "Watching" respectively, defaults to :game. You can also pass the number of the discord status type directly if it isn't listed here.
url: link to display with the :stream type, currently only urls starting with <a href="https://twitch.tv/">https://twitch.tv/</a> will work, defaults to nil</pre></div></div><div class="public anchor" id="var-disconnect-bot.21"><h3>disconnect-bot!</h3><div class="usage"><code>(disconnect-bot! connection-ch)</code></div><div class="doc"><pre class="plaintext">Takes the channel returned by connect-bot! and stops the connection.
</pre></div></div><div class="public anchor" id="var-gateway-intents"><h3>gateway-intents</h3><div class="usage"></div><div class="doc"><pre class="plaintext">All the valid intent keywords to send to Discord.
</pre></div></div><div class="public anchor" id="var-get-shard-state.21"><h3>get-shard-state!</h3><div class="usage"><code>(get-shard-state! connection-ch)</code><code>(get-shard-state! connection-ch shards)</code></div><div class="doc"><pre class="plaintext">Fetches the current shard session state.

`shards` is an optional set of shard state values. If it is not included, all
shards will be fetched. Any shard which matches with the given keys will be
included.

Returns a promise which can be derefed or taken off of like a channel.</pre></div></div><div class="public anchor" id="var-get-websocket-gateway"><h3>get-websocket-gateway</h3><div class="usage"><code>(get-websocket-gateway token)</code></div><div class="doc"><pre class="plaintext">Gets the shard count and websocket endpoint from Discord's API.

Takes the `token` of the bot.

Returns a map with the keys :url, :shard-count, and :session-start limit, or
nil in the case of an error.</pre></div></div><div class="public anchor" id="var-guild-request-members.21"><h3>guild-request-members!</h3><div class="usage"><code>(guild-request-members! connection-ch guild-id &amp; args)</code></div><div class="doc"><pre class="plaintext">Takes the channel returned by connect-bot!, the snowflake guild id, and optional arguments
about the members you want to get information about, and signals Discord to send you
:guild-members-chunk events.

Keyword Arguments:
query: a string that the username of the searched user starts with, or empty string for all users, defaults to empty string
limit: the maximum number of members to give based on the query</pre></div></div><div class="public anchor" id="var-remove-shards.21"><h3>remove-shards!</h3><div class="usage"><code>(remove-shards! connection-ch shards)</code></div><div class="doc"><pre class="plaintext">Removes shards matching any of the passed shards.

This will ignore the `:seq` keyword on any passed shard, but otherwise is as
one of the shards returned from `get-shard-state!`.</pre></div></div><div class="public anchor" id="var-status-update.21"><h3>status-update!</h3><div class="usage"><code>(status-update! connection-ch &amp; args)</code></div><div class="doc"><pre class="plaintext">Takes the channel returned by connect-bot! and a set of keyword options, and updates
Discord with a new status for your bot.

Keyword Arguments:
idle-since: epoch time in milliseconds of when the bot went idle, defaults to nil
activity: an activity map, from create-activity, which is used for the bot, defaults to nil
status: a keyword representing the current status of the bot, can be :online, :dnd, :idle, :invisible, or :offline, defaults to :online
afk: a boolean to say if the bot is afk, defaults to false
shards: a set of shard ids to send this update to, or the keyword `:all`</pre></div></div><div class="public anchor" id="var-voice-state-update.21"><h3>voice-state-update!</h3><div class="usage"><code>(voice-state-update! connection-ch guild-id &amp; args)</code></div><div class="doc"><pre class="plaintext">Takes the channel returned by connect-bot!, a guild id, and a set of keyword options and
updates Discord with a new voice state.

Keyword Arguments:
channel-id: the new channel id snowflake that your bot is in, disconnect if nil, defaults to nil
mute: boolean which says if the bot is muted
deaf: boolean which says if the bot is deafened</pre></div></div></div></body></html>