<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>discljord.events.state documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name"></span> <span class="project-version"></span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>discljord</span></div></div></li><li class="depth-2 branch"><a href="discljord.cdn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cdn</span></div></a></li><li class="depth-2"><a href="discljord.connections.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>connections</span></div></a></li><li class="depth-3 branch"><a href="discljord.connections.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-3"><a href="discljord.connections.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2"><a href="discljord.events.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>events</span></div></a></li><li class="depth-3 branch"><a href="discljord.events.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 current"><a href="discljord.events.state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-2 branch"><a href="discljord.formatting.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>formatting</span></div></a></li><li class="depth-2 branch"><a href="discljord.http.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>http</span></div></a></li><li class="depth-2"><a href="discljord.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="discljord.messaging.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-3"><a href="discljord.messaging.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2 branch"><a href="discljord.permissions.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>permissions</span></div></a></li><li class="depth-2 branch"><a href="discljord.snowflakes.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>snowflakes</span></div></a></li><li class="depth-2 branch"><a href="discljord.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2"><a href="discljord.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="discljord.events.state.html#var-caching-handlers"><div class="inner"><span>caching-handlers</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-caching-middleware"><div class="inner"><span>caching-middleware</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-caching-transducer"><div class="inner"><span>caching-transducer</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-channel-delete"><div class="inner"><span>channel-delete</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-channel-pins-update"><div class="inner"><span>channel-pins-update</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-channel-update"><div class="inner"><span>channel-update</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-guild-emojis-update"><div class="inner"><span>guild-emojis-update</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-guild-member-remove"><div class="inner"><span>guild-member-remove</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-guild-member-update"><div class="inner"><span>guild-member-update</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-guild-members-chunk"><div class="inner"><span>guild-members-chunk</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-guild-role-delete"><div class="inner"><span>guild-role-delete</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-guild-role-update"><div class="inner"><span>guild-role-update</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-guild-update"><div class="inner"><span>guild-update</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-message-create"><div class="inner"><span>message-create</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-prepare-guild"><div class="inner"><span>prepare-guild</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-prepare-thread"><div class="inner"><span>prepare-thread</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-presence-update"><div class="inner"><span>presence-update</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-ready"><div class="inner"><span>ready</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-thread-delete"><div class="inner"><span>thread-delete</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-thread-list-sync"><div class="inner"><span>thread-list-sync</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-thread-member-update"><div class="inner"><span>thread-member-update</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-thread-members-update"><div class="inner"><span>thread-members-update</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-thread-update"><div class="inner"><span>thread-update</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-user-update"><div class="inner"><span>user-update</span></div></a></li><li class="depth-1"><a href="discljord.events.state.html#var-voice-state-update"><div class="inner"><span>voice-state-update</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">discljord.events.state</h1><div class="doc"><pre class="plaintext">Middleware to cache all the state that Discord sends.
</pre></div><div class="public anchor" id="var-caching-handlers"><h3>caching-handlers</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Handler map for all state-caching events.

The state saved is of the following form:
```clojure
{:discljord.events.state/bot &lt;current-user&gt;
 :discljord.events.state/guilds {&lt;guild-id&gt; &lt;guild-object&gt;}
 :discljord.events.state/users {&lt;user-id&gt; &lt;user-object&gt;}
 :discljord.events.state/private-channels {&lt;channel-id&gt; &lt;channel-object&gt;}}
```

Guild objects are modified in a few ways. Roles, members, presences, threads and
channels are all stored as maps from id to object, and members' and presence's
user keys are the id of the user which is stored under the state's
`:discljord.events.state/users` key. Any information received from
`:presence-update` events is also merged into the user object, and a voice
state object is stored under `:voice`.

Threads also include a map of user ids to
[thread member objects](<a href="https://discord.com/developers/docs/resources/channel#thread-member-object)">https://discord.com/developers/docs/resources/channel#thread-member-object)</a> in their `:member` key.

Private channels are channels which lack a guild, including direct messages
and group messages.</pre></div></div><div class="public anchor" id="var-caching-middleware"><h3>caching-middleware</h3><div class="usage"><code>(caching-middleware state)</code><code>(caching-middleware state caching-handlers)</code></div><div class="doc"><pre class="plaintext">Creates a middleware that caches Discord event data in `state`.

`state` must be an [[clojure.core/atom]] containing a map.
`caching-handlers`, if provided, must be a map of event keyword -&gt; sequence of caching handlers.
Each caching handler is a function that takes the event type, data and the state atom and updates the atom where applicable.

If this parameter is not provided, the default [[caching-handlers]] are used.
See its docs for more information on the default cache layout and behavior.</pre></div></div><div class="public anchor" id="var-caching-transducer"><h3>caching-transducer</h3><div class="usage"><code>(caching-transducer state)</code><code>(caching-transducer state caching-handlers)</code></div><div class="doc"><pre class="plaintext">Creates a transducer which caches event data and passes on all events.

Values on the transducer are expected to be tuples of event-type and
event-data.
`state` must be an [[clojure.core/atom]] containing a map.
`caching-handlers`, if provided, must be a map of event keyword -&gt; sequence of caching handlers.
Each caching handler is a function that takes the event type, data and the state atom and updates the atom where applicable.

If this parameter is not provided, the default [[caching-handlers]] are used.
See its docs for more information on the default cache layout and behavior.</pre></div></div><div class="public anchor" id="var-channel-delete"><h3>channel-delete</h3><div class="usage"><code>(channel-delete _ channel state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-channel-pins-update"><h3>channel-pins-update</h3><div class="usage"><code>(channel-pins-update _ {:keys [guild-id channel-id last-pin-timestamp]} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-channel-update"><h3>channel-update</h3><div class="usage"><code>(channel-update _ channel state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-guild-emojis-update"><h3>guild-emojis-update</h3><div class="usage"><code>(guild-emojis-update _ {:keys [guild-id emojis]} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-guild-member-remove"><h3>guild-member-remove</h3><div class="usage"><code>(guild-member-remove _ {:keys [guild-id user]} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-guild-member-update"><h3>guild-member-update</h3><div class="usage"><code>(guild-member-update _ {:keys [guild-id user], :as member} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-guild-members-chunk"><h3>guild-members-chunk</h3><div class="usage"><code>(guild-members-chunk _ {:keys [guild-id members]} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-guild-role-delete"><h3>guild-role-delete</h3><div class="usage"><code>(guild-role-delete _ {:keys [guild-id role-id]} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-guild-role-update"><h3>guild-role-update</h3><div class="usage"><code>(guild-role-update _ {:keys [guild-id role]} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-guild-update"><h3>guild-update</h3><div class="usage"><code>(guild-update _ guild state)</code></div><div class="doc"><pre class="plaintext">Stores the guild into the state.
</pre></div></div><div class="public anchor" id="var-message-create"><h3>message-create</h3><div class="usage"><code>(message-create _ {:keys [guild-id channel-id id]} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-prepare-guild"><h3>prepare-guild</h3><div class="usage"><code>(prepare-guild guild)</code></div><div class="doc"><pre class="plaintext">Takes a guild and prepares it for storing in the cache.

The roles vector will be transformed to a map keyed off if, members
transformed to a map from user id to member object with `:user` key replaced
by the user id, channels will be changed to a map from id to channel object.</pre></div></div><div class="public anchor" id="var-prepare-thread"><h3>prepare-thread</h3><div class="usage"><code>(prepare-thread {:keys [member], :as thread})</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-presence-update"><h3>presence-update</h3><div class="usage"><code>(presence-update _ {:keys [user guild-id activities status client-status], :as presence} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-ready"><h3>ready</h3><div class="usage"><code>(ready _ {:keys [user guilds]} state)</code></div><div class="doc"><pre class="plaintext">Stores the user and guilds into the state.
</pre></div></div><div class="public anchor" id="var-thread-delete"><h3>thread-delete</h3><div class="usage"><code>(thread-delete _ {:keys [guild-id id]} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-thread-list-sync"><h3>thread-list-sync</h3><div class="usage"><code>(thread-list-sync _ {:keys [guild-id channel-ids threads members]} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-thread-member-update"><h3>thread-member-update</h3><div class="usage"><code>(thread-member-update _ {:keys [guild-id id user-id], :as member} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-thread-members-update"><h3>thread-members-update</h3><div class="usage"><code>(thread-members-update _ {:keys [added-members removed-member-ids id guild-id member-count :as event]} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-thread-update"><h3>thread-update</h3><div class="usage"><code>(thread-update _ {:keys [guild-id id], {:keys [archived]} :thread-metadata, :as thread} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-user-update"><h3>user-update</h3><div class="usage"><code>(user-update _ user state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-voice-state-update"><h3>voice-state-update</h3><div class="usage"><code>(voice-state-update _ {:keys [user-id], :as voice} state)</code></div><div class="doc"><pre class="plaintext"></pre></div></div></div></body></html>