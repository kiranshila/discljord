<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>discljord.connections.impl documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name"></span> <span class="project-version"></span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>discljord</span></div></div></li><li class="depth-2 branch"><a href="discljord.cdn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cdn</span></div></a></li><li class="depth-2"><a href="discljord.connections.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>connections</span></div></a></li><li class="depth-3 branch current"><a href="discljord.connections.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-3"><a href="discljord.connections.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2"><a href="discljord.events.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>events</span></div></a></li><li class="depth-3 branch"><a href="discljord.events.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3"><a href="discljord.events.state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-2 branch"><a href="discljord.formatting.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>formatting</span></div></a></li><li class="depth-2 branch"><a href="discljord.http.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>http</span></div></a></li><li class="depth-2"><a href="discljord.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="discljord.messaging.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-3"><a href="discljord.messaging.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2 branch"><a href="discljord.permissions.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>permissions</span></div></a></li><li class="depth-2 branch"><a href="discljord.snowflakes.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>snowflakes</span></div></a></li><li class="depth-2 branch"><a href="discljord.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2"><a href="discljord.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="discljord.connections.impl.html#var-*handle-re-shard*"><div class="inner"><span>*handle-re-shard*</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-*identify-limiter*"><div class="inner"><span>*identify-limiter*</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-*identify-when*"><div class="inner"><span>*identify-when*</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-*stop-on-fatal-code*"><div class="inner"><span>*stop-on-fatal-code*</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-after-timeout.21"><div class="inner"><span>after-timeout!</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-buffer-size"><div class="inner"><span>buffer-size</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-byte-array-buffer-size"><div class="inner"><span>byte-array-buffer-size</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-connect-shards.21"><div class="inner"><span>connect-shards!</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-connect-websocket.21"><div class="inner"><span>connect-websocket!</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-fatal-code.3F"><div class="inner"><span>fatal-code?</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-get-shard-from-guild"><div class="inner"><span>get-shard-from-guild</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-get-websocket-gateway"><div class="inner"><span>get-websocket-gateway</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-handle-bot-fx.21"><div class="inner"><span>handle-bot-fx!</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-handle-communication.21"><div class="inner"><span>handle-communication!</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-handle-connection-event.21"><div class="inner"><span>handle-connection-event!</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-handle-discord-event"><div class="inner"><span>handle-discord-event</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-handle-payload"><div class="inner"><span>handle-payload</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-handle-shard-communication.21"><div class="inner"><span>handle-shard-communication!</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-handle-shard-fx.21"><div class="inner"><span>handle-shard-fx!</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-handle-websocket-event"><div class="inner"><span>handle-websocket-event</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-intent-.3Eintent-int"><div class="inner"><span>intent-&gt;intent-int</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-make-identify-fn"><div class="inner"><span>make-identify-fn</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-make-shard"><div class="inner"><span>make-shard</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-new-session-stop-code.3F"><div class="inner"><span>new-session-stop-code?</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-re-shard-stop-code.3F"><div class="inner"><span>re-shard-stop-code?</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-remove-shards"><div class="inner"><span>remove-shards</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-run-on-agent-with-limit"><div class="inner"><span>run-on-agent-with-limit</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-shard-matches-any.3F"><div class="inner"><span>shard-matches-any?</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-shard-matches.3F"><div class="inner"><span>shard-matches?</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-should-resume.3F"><div class="inner"><span>should-resume?</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-step-shard.21"><div class="inner"><span>step-shard!</span></div></a></li><li class="depth-1"><a href="discljord.connections.impl.html#var-user-error-code.3F"><div class="inner"><span>user-error-code?</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">discljord.connections.impl</h1><div class="doc"><pre class="plaintext">Implementation of websocket connections to Discord.
</pre></div><div class="public anchor" id="var-*handle-re-shard*"><h3>*handle-re-shard*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Determines if the bot will re-shard on its own, or require user coordination.
If bound to true and a re-shard occurs, the bot will make a request to discord
for the new number of shards to connect with and then connect them. If bound
to false, then a :re-shard event will be sent to the user library and all
shards will be disconnected.</pre></div></div><div class="public anchor" id="var-*identify-limiter*"><h3>*identify-limiter*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-*identify-when*"><h3>*identify-when*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Function that returns a channel that yields when it's time to identify.
</pre></div></div><div class="public anchor" id="var-*stop-on-fatal-code*"><h3>*stop-on-fatal-code*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Bind to to true to disconnect the entire bot after a fatal stop code.
</pre></div></div><div class="public anchor" id="var-after-timeout.21"><h3>after-timeout!</h3><div class="usage"><code>(after-timeout! f timeout)</code></div><div class="doc"><pre class="plaintext">Calls a function of no arguments after the given `timeout`.
Returns a channel which will have the return value of the function put on it.</pre></div></div><div class="public anchor" id="var-buffer-size"><h3>buffer-size</h3><div class="usage"></div><div class="doc"><pre class="plaintext">The maximum size of the websocket buffer
</pre></div></div><div class="public anchor" id="var-byte-array-buffer-size"><h3>byte-array-buffer-size</h3><div class="usage"></div><div class="doc"><pre class="plaintext">The size of the byte array to allocate for the decompression buffer
</pre></div></div><div class="public anchor" id="var-connect-shards.21"><h3>connect-shards!</h3><div class="usage"><code>(connect-shards! output-ch communication-ch url token intents shard-count shard-ids compress)</code></div><div class="doc"><pre class="plaintext">Connects a set of shards with the given `shard-ids`.
Returns nil.</pre></div></div><div class="public anchor" id="var-connect-websocket.21"><h3>connect-websocket!</h3><div class="usage"><code>(connect-websocket! buffer-size url event-ch compress)</code></div><div class="doc"><pre class="plaintext">Connect a websocket to the `url` that puts all events onto the `event-ch`.
Events are represented as vectors with a keyword for the event type and then
event data as the rest of the vector based on the type of event.

| Type          | Data |
|---------------+------|
| `:connect`    | None.
| `:disconnect` | Stop code, string message.
| `:error`      | Error value.
| `:message`    | String message.</pre></div></div><div class="public anchor" id="var-fatal-code.3F"><h3>fatal-code?</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Set of stop codes which after recieving, discljord will disconnect all shards.
</pre></div></div><div class="public anchor" id="var-get-shard-from-guild"><h3>get-shard-from-guild</h3><div class="usage"><code>(get-shard-from-guild guild-id guild-count)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-get-websocket-gateway"><h3>get-websocket-gateway</h3><div class="usage"><code>(get-websocket-gateway url token)</code></div><div class="doc"><pre class="plaintext">Gets the shard count and websocket endpoint from Discord's API.

Takes the `url` of the gateway and the `token` of the bot.

Returns a map with the keys :url, :shard-count, and :session-start limit, or
nil in the case of an error.</pre></div></div><div class="public anchor" id="var-handle-bot-fx.21"><h3>handle-bot-fx!</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Handles a bot-level side effect triggered by a shard.
This method should never block, and should not do intense computation. Takes a
place to output events to the library user, the url to connect sockets, the
bot's token, the vector of shards, a vector of channels which resolve to the
shard's next state, the index of the shard the effect is from, and the effect.
Returns a vector of the vector of shards and the vector of shard channels.</pre></div></div><div class="public anchor" id="var-handle-communication.21"><h3>handle-communication!</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Handles communicating to the `shards`.
Takes an `event` vector, a vector of `shards`, and a vector of channels which
resolve to each shard's next state, and returns a vector of the vector of
shards and the vector of channels.</pre></div></div><div class="public anchor" id="var-handle-connection-event.21"><h3>handle-connection-event!</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Handles events which connect or disconnect the shard, returning effects.
</pre></div></div><div class="public anchor" id="var-handle-discord-event"><h3>handle-discord-event</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Handles discord events for a specific shard, specifying effects.
</pre></div></div><div class="public anchor" id="var-handle-payload"><h3>handle-payload</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Update a `shard` based on a message.
Takes a `shard` and `msg` and returns a map with a :shard and an :effects
vector.</pre></div></div><div class="public anchor" id="var-handle-shard-communication.21"><h3>handle-shard-communication!</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Processes a communication `event` on the given `shard` for side effects.
Returns a map with the new :shard and bot-evel :effects to process.</pre></div></div><div class="public anchor" id="var-handle-shard-fx.21"><h3>handle-shard-fx!</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Processes an `event` on a given `shard` for side effects.
Returns a map with the new :shard and bot-level :effects to process.</pre></div></div><div class="public anchor" id="var-handle-websocket-event"><h3>handle-websocket-event</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Updates a `shard` based on shard events.
Takes a `shard` and a shard event vector and returns a map of the new state of
the shard and zero or more events to process.</pre></div></div><div class="public anchor" id="var-intent-.3Eintent-int"><h3>intent-&gt;intent-int</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-make-identify-fn"><h3>make-identify-fn</h3><div class="usage"><code>(make-identify-fn token shard)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-make-shard"><h3>make-shard</h3><div class="usage"><code>(make-shard intents id shard-count compress)</code></div><div class="doc"><pre class="plaintext">Creates a new shard with the given `id` and `shard-count`.
</pre></div></div><div class="public anchor" id="var-new-session-stop-code.3F"><h3>new-session-stop-code?</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Set of stop codes after which a resume isn't possible.
</pre></div></div><div class="public anchor" id="var-re-shard-stop-code.3F"><h3>re-shard-stop-code?</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Stop codes which Discord will send when the bot needs to be re-sharded.
</pre></div></div><div class="public anchor" id="var-remove-shards"><h3>remove-shards</h3><div class="usage"><code>(remove-shards pred shards shard-chs)</code></div><div class="doc"><pre class="plaintext">Removes shards fitting a predicate from the vector of shards and channels.
</pre></div></div><div class="public anchor" id="var-run-on-agent-with-limit"><h3>run-on-agent-with-limit</h3><div class="usage"><code>(run-on-agent-with-limit a f millis)</code></div><div class="doc"><pre class="plaintext">Runs the given function on the agent, then other actions wait `millis`.
</pre></div></div><div class="public anchor" id="var-shard-matches-any.3F"><h3>shard-matches-any?</h3><div class="usage"><code>(shard-matches-any? match-any shard)</code></div><div class="doc"><pre class="plaintext">Returns true if the shard matches against any of the passed matchers.
</pre></div></div><div class="public anchor" id="var-shard-matches.3F"><h3>shard-matches?</h3><div class="usage"><code>(shard-matches? shard match)</code></div><div class="doc"><pre class="plaintext">Returns true if all keys in `match` are equal to the ones in `shard`.
</pre></div></div><div class="public anchor" id="var-should-resume.3F"><h3>should-resume?</h3><div class="usage"><code>(should-resume? shard)</code></div><div class="doc"><pre class="plaintext">Returns if a shard should try to resume.
</pre></div></div><div class="public anchor" id="var-step-shard.21"><h3>step-shard!</h3><div class="usage"><code>(step-shard! shard url token)</code></div><div class="doc"><pre class="plaintext">Starts a process to step a `shard`, handling side-effects.
Returns a channel which will have a map with the new `:shard` and a vector of
`:effects` for the entire bot to respond to placed on it after the next item
the socket may respond to occurs.</pre></div></div><div class="public anchor" id="var-user-error-code.3F"><h3>user-error-code?</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Set of stop codes which can only be received if there was user error.
</pre></div></div></div></body></html>